<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="orders">

	<!-- 리스트 페이징O/검색O -->
	<select id="paymentManageList" parameterType="map" resultType="OrdersVo">
		<![CDATA[
			select *
			from orders
		]]>
		<choose>
			<when test="keyword != null and category != null and category == 0">
				<![CDATA[
					where (o_name like concat('%', #{keyword}, '%') 
							or o_hp like concat('%', #{keyword}, '%') 
							or o_address like concat('%', #{keyword}, '%')
							or o_date like concat('%', #{keyword}, '%'))
				]]>
			</when>
				
			<when test="keyword != null and category != null and category == 1">
				<![CDATA[
					where (o_name like concat('%', #{keyword}, '%'))
				]]>
			</when>	
			<when test="keyword != null and category != null and category == 2">
				<![CDATA[
					where (o_hp like concat('%', #{keyword}, '%'))
				]]>
			</when>
			
			<otherwise></otherwise>
		</choose>
		<![CDATA[		
				order by o_no desc		 
				limit #{startRowNo}, #{listCnt}
			]]>
	</select>
	
	
	<select id="selectOrdersTotalCnt" parameterType="map" resultType="int">
		<![CDATA[
			select count(*) count
			from orders
		]]>
		<choose>
			<when test="keyword != null and category != null and category == 0">
				<![CDATA[
					where (o_name like concat('%', #{keyword}, '%') 
							or o_hp like concat('%', #{keyword}, '%') 
							or o_address like concat('%', #{keyword}, '%')
							or o_date like concat('%', #{keyword}, '%'))
				]]>
			</when>
			<when test="keyword != null and category != null and category == 1">
				<![CDATA[
					where (o_name like concat('%', #{keyword}, '%'))
				]]>
			</when>	
			<when test="keyword != null and category != null and category == 2">
				<![CDATA[
					where (o_hp like concat('%', #{keyword}, '%'))
				]]>
			</when>
			
			<otherwise></otherwise>
		</choose>
	</select>
	
	
	<!-- 배송상태 변경 -->
	<update id="pStatusChange" parameterType="int">
		<![CDATA[
		update orders
		set o_status = o_status + 1
		where o_no = #{o_no}
		]]>
	</update>
	
	
	<!-- 회원 결제창 -->
	<!-- 정보 불러오기 -->
	<select id="cartList" parameterType="int" resultType="CartVo">
		<![CDATA[
			select c.c_no,
				   p.p_name,
				   p.p_price,
				   c.c_p_amount,
				   c.c_size,
				   p.p_no
			from cart c,product p,user u
			where c.user_no = u.user_no
			and c.p_no = p.p_no
			and c.user_no = #{user_no};
		]]>
	</select>
	
	<select id="userInfo" parameterType="int" resultType="UserVo">
		<![CDATA[
			select user_name, 
				     user_hp,
			         user_address
			from user
			where user_no = #{user_no};
		]]>
	</select>
	
	<insert id="insertOrders" parameterType="OrdersVo">
		<![CDATA[
			insert into orders
			values(null, #{user_no}, #{o_name}, #{o_address}, #{o_hp}, #{o_request}, #{totalprice}, now(), '0', #{o_payement})
		]]>
	</insert>
	
	
	
</mapper>